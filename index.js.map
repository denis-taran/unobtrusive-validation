{"version":3,"file":"index.js","sources":["index.ts"],"sourcesContent":[" /*\r\n  * https://github.com/kraaden/unobtrusive-validation\r\n  * Copyright (c) 2016 Denys Krasnoshchok\r\n  * MIT License\r\n  */\r\n\r\ninterface IFormElement extends HTMLElement {\r\n    value: string;\r\n    type: string;\r\n}\r\n\r\n/**\r\n * List of handlers that will be executed after validation is finished for the submitted form.\r\n * You can use them to hide/show a spinner or do some additional work.\r\n */\r\nexport const form_validation_handlers: ((evt: Event, succeeded: boolean) => void)[] = [];\r\n\r\n/**\r\n * List of validators used by the library to validate form elements\r\n */\r\nexport const form_validators: ((element: IFormElement) => boolean)[] = [];\r\n\r\nfunction getElementValue(element: IFormElement): string {\r\n    return element.value;\r\n}\r\n\r\nfunction findContainer(element: HTMLElement): HTMLSpanElement | null {\r\n    return document.querySelector(`span[data-valmsg-for='${element.getAttribute(\"name\")}']`) as HTMLSpanElement | null;\r\n}\r\n\r\nfunction isInt(value: string): boolean {\r\n    return !isNaN(value as any) && Number.isInteger(parseFloat(value));\r\n}\r\n\r\nfunction clearError(element: HTMLElement) {\r\n    const container = findContainer(element);\r\n    if (container) {\r\n        while (container.firstChild) {\r\n            const child = container.firstChild;\r\n            const parent = child.parentNode;\r\n            if (parent) {\r\n                parent.removeChild(child);\r\n            }\r\n        }\r\n        container.classList.add(\"data-validation-valid\");\r\n    }\r\n}\r\n\r\nfunction validateElement(element: IFormElement): boolean {\r\n    let success = true;\r\n    for (const validator of form_validators) {\r\n        success = success && validator(element);\r\n    }\r\n    if (success) {\r\n        clearError(element);\r\n    }\r\n    return success;\r\n}\r\n\r\nfunction showError(element: HTMLElement, message: string) {\r\n    clearError(element);\r\n    const container = findContainer(element);\r\n    if (container) {\r\n        container.textContent = message;\r\n        container.classList.add(\"field-validation-error\");\r\n    }\r\n}\r\n\r\nfunction requiredValidator(element: IFormElement): boolean {\r\n    const message = element.getAttribute(\"data-val-required\");\r\n    if (message) {\r\n        const val = getElementValue(element).trim();\r\n        if (!val) {\r\n            showError(element, message);\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\n\r\nfunction numberValidator(element: IFormElement): boolean {\r\n    const message = element.getAttribute(\"data-val-number\");\r\n    if (message) {\r\n        const val = getElementValue(element).trim();\r\n        if (!isInt(val)) {\r\n            showError(element, message);\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\n\r\nfunction lengthValidator(element: IFormElement): boolean {\r\n    const errorMsg = element.getAttribute(\"data-val-length\");\r\n    const minlen = element.getAttribute(\"data-val-length-min\");\r\n    const maxlen = element.getAttribute(\"data-val-length-max\");\r\n    const value = getElementValue(element);\r\n    if (errorMsg && value) {\r\n        if (maxlen) {\r\n            const max = parseInt(maxlen, 10);\r\n            if (value.length > max) {\r\n                showError(element, errorMsg);\r\n                return false;\r\n            }\r\n        }\r\n        if (minlen) {\r\n            const min = parseInt(minlen, 10);\r\n            if (value.length < min) {\r\n                showError(element, errorMsg);\r\n                return false;\r\n            }\r\n        }\r\n    }\r\n    return true;\r\n}\r\n\r\nfunction regexValidator(element: IFormElement): boolean {\r\n    const errorMsg = element.getAttribute(\"data-val-regex\");\r\n    const regexPattern = element.getAttribute(\"data-val-regex-pattern\");\r\n    const value = getElementValue(element);\r\n    if (errorMsg && regexPattern && value) {\r\n        if (!value.match(`^${regexPattern}$`)) {\r\n            showError(element, errorMsg);\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\n\r\nfunction equalityValidator(element: IFormElement): boolean {\r\n    const errorMsg = element.getAttribute(\"data-val-equalto\");\r\n    const other = element.getAttribute(\"data-val-equalto-other\") || \"\";\r\n    const name = other.replace(/[^0-9a-zA-Z_]/g, '');\r\n    if (name) {\r\n        const anotherField = document.querySelector(\"[name='\" + name + \"']\") as IFormElement;\r\n        if (errorMsg && anotherField) {\r\n            if (anotherField.value !== element.value) {\r\n                showError(element, errorMsg);\r\n                return false;\r\n            }\r\n        }\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\nfunction rangeValidator(element: IFormElement): boolean {\r\n    const errorMsg = element.getAttribute(\"data-val-range\");\r\n    const minval = element.getAttribute(\"data-val-range-min\");\r\n    const maxval = element.getAttribute(\"data-val-range-max\");\r\n    const value = getElementValue(element);\r\n\r\n    if (errorMsg && isInt(value)) {\r\n        const number = parseInt(value, 10);\r\n        if (minval) {\r\n            const min = parseInt(minval, 10);\r\n            if (number < min) {\r\n                showError(element, errorMsg);\r\n                return false;\r\n            }\r\n        }\r\n        if (maxval) {\r\n            const max = parseInt(maxval, 10);\r\n            if (number > max) {\r\n                showError(element, errorMsg);\r\n                return false;\r\n            }\r\n        }\r\n    }\r\n    return true;\r\n}\r\n\r\nfunction addChangeListener(element: HTMLElement) {\r\n    if (element.nodeName === \"TEXTAREA\") {\r\n        element.addEventListener(\"keyup\", () => {\r\n            validateElement(element as HTMLTextAreaElement);\r\n        });\r\n        return;\r\n    }\r\n    if (element.nodeName === \"INPUT\") {\r\n        const input = element as HTMLInputElement;\r\n        if (input.type === \"text\" || input.type === \"password\") {\r\n            input.addEventListener(\"keyup\", () => {\r\n                validateElement(input);\r\n            });\r\n            return;\r\n        }\r\n    }\r\n    if (element.nodeName === \"SELECT\") {\r\n        const select = element as HTMLSelectElement;\r\n        select.addEventListener(\"change\", () => {\r\n            validateElement(select);\r\n        });\r\n    }\r\n}\r\n\r\nfunction validateForm(form: HTMLFormElement): boolean {\r\n    let valid = true;\r\n    const submit = form.getAttribute(\"data-submitted\");\r\n    \r\n    if (!submit) {\r\n        form.setAttribute(\"data-submitted\", \"true\");\r\n    }\r\n\r\n    var inputs = form.querySelectorAll<HTMLInputElement>(\"input, textarea, select\");\r\n\r\n    [].forEach.call(inputs, function(input: HTMLInputElement) {\r\n        if (input.type === \"hidden\") {\r\n            return;\r\n        }\r\n        if (!submit) {\r\n            addChangeListener(input);\r\n        }\r\n        const current = validateElement(input);\r\n        valid = valid && current;\r\n    });\r\n    \r\n    return valid;\r\n}\r\n\r\nform_validators.push(requiredValidator);\r\nform_validators.push(lengthValidator);\r\nform_validators.push(regexValidator);\r\nform_validators.push(rangeValidator);\r\nform_validators.push(numberValidator);\r\nform_validators.push(equalityValidator);\r\n\r\nfunction executeHandlers(evt: Event, succeeded: boolean) {\r\n    for (let handler of form_validation_handlers) {\r\n        handler(evt, succeeded);\r\n    }\r\n}\r\n\r\nwindow.addEventListener('DOMContentLoaded', function() {\r\n    var elements = document.querySelectorAll<HTMLFormElement>('form');\r\n\r\n    [].forEach.call(elements, function(form: HTMLFormElement) {\r\n        form.addEventListener(\"submit\", function(ev) {\r\n            if (!validateForm(form)) {\r\n                executeHandlers(ev, false);\r\n                ev.preventDefault();\r\n                return;\r\n            }\r\n\r\n            executeHandlers(ev, true);\r\n        });\r\n    });\r\n});"],"names":[],"mappings":"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"}